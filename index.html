<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNOTRA-AI</title></title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: 600px;
        }

        .sidebar {
            background: #f8f9fa;
            border-right: 1px solid #e0e0e0;
            padding: 20px;
        }

        .nav-item {
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        .nav-item:hover {
            background: #e0e0e0;
        }

        .nav-item.active {
            background: #667eea;
            color: white;
        }

        .content-area {
            padding: 30px;
            overflow-y: auto;
            max-height: 80vh;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .upload-area:hover {
            background: #e8ecff;
            border-color: #764ba2;
        }

        .upload-area.dragover {
            background: #e8ecff;
            border-color: #764ba2;
            transform: scale(1.02);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #6c757d;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
        }

        input[type="file"] {
            display: none;
        }

        .file-info {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .summary-box, .quiz-container, .test-container, .mindmap-container, .chat-container, .videos-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }

        .question-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .option {
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option.selected {
            border-color: #667eea;
            background: #e8ecff;
        }

        .option.correct {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .option.incorrect {
            border-color: #f44336;
            background: #ffebee;
        }

        .chat-messages {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
        }

        .message.user {
            background: #667eea;
            color: white;
            margin-left: auto;
        }

        .message.assistant {
            background: #f0f0f0;
            color: #333;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .video-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .video-card:hover {
            transform: translateY(-5px);
        }

        .video-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .video-info {
            padding: 15px;
        }

        .video-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .video-channel {
            font-size: 0.9rem;
            color: #666;
        }

        .mindmap-node {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .mindmap-branch {
            margin-left: 30px;
            margin-top: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 600;
            font-size: 0.9rem;
            color: #666;
        }

        .control-group select {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }

        .score-card h2 {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        h3 {
            color: #667eea;
            margin: 20px 0 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì AI Learning System</h1>
            <p>Upload, Learn, and Master Your Subject with AI</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="nav-item active" data-section="upload">
                    üìÅ Upload Document
                </div>
                <div class="nav-item" data-section="summary">
                    üìù Summary
                </div>
                <div class="nav-item" data-section="quiz">
                    ‚ùì Quiz
                </div>
                <div class="nav-item" data-section="mock-test">
                    üìã Mock Test
                </div>
                <div class="nav-item" data-section="mindmap">
                    üß† Mind Map
                </div>
                <div class="nav-item" data-section="chat">
                    üí¨ AI Tutor
                </div>
                <div class="nav-item" data-section="videos">
                    üé• Video Resources
                </div>
            </div>

            <div class="content-area">
                <!-- Upload Section -->
                <div class="section active" id="upload">
                    <h2>Upload Your Learning Material</h2>
                    <div class="upload-area" id="uploadArea">
                        <h3>üì§ Drag & Drop or Click to Upload</h3>
                        <p>Supported formats: PDF, DOCX, TXT, MD</p>
                        <p style="margin-top: 10px; color: #666;">Max file size: 16MB</p>
                        <input type="file" id="fileInput" accept=".pdf,.docx,.txt,.md">
                    </div>
                    <div id="fileInfo" style="display: none;"></div>
                </div>

                <!-- Summary Section -->
                <div class="section" id="summary">
                    <h2>Document Summary</h2>
                    <button class="btn" onclick="generateSummary()">Generate Summary</button>
                    <div id="summaryContent" class="summary-box" style="display: none;"></div>
                </div>

                <!-- Quiz Section -->
                <div class="section" id="quiz">
                    <h2>Interactive Quiz</h2>
                    <div class="controls">
                        <div class="control-group">
                            <label>Number of Questions:</label>
                            <select id="numQuestions">
                                <option value="5">5 Questions</option>
                                <option value="10" selected>10 Questions</option>
                                <option value="15">15 Questions</option>
                                <option value="20">20 Questions</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Difficulty:</label>
                            <select id="difficulty">
                                <option value="easy">Easy</option>
                                <option value="medium" selected>Medium</option>
                                <option value="hard">Hard</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>&nbsp;</label>
                            <button class="btn" onclick="generateQuiz()">Generate Quiz</button>
                        </div>
                    </div>
                    <div id="quizContent" class="quiz-container" style="display: none;"></div>
                </div>

                <!-- Mock Test Section -->
                <div class="section" id="mock-test">
                    <h2>Mock Test</h2>
                    <button class="btn" onclick="generateMockTest()">Generate Mock Test</button>
                    <div id="testContent" class="test-container" style="display: none;"></div>
                </div>

                <!-- Mind Map Section -->
                <div class="section" id="mindmap">
                    <h2>Mind Map</h2>
                    <button class="btn" onclick="generateMindMap()">Generate Mind Map</button>
                    <div id="mindmapContent" class="mindmap-container" style="display: none;"></div>
                </div>

                <!-- Chat Section -->
                <div class="section" id="chat">
                    <h2>AI Tutor Chat</h2>
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <div class="message assistant">
                                Hello! I'm your AI tutor. Upload a document and ask me anything about it!
                            </div>
                        </div>
                        <div class="chat-input">
                            <input type="text" id="chatInput" placeholder="Ask a question..." onkeypress="handleChatKeypress(event)">
                            <button class="btn" onclick="sendMessage()">Send</button>
                        </div>
                    </div>
                </div>

                <!-- Videos Section -->
                <div class="section" id="videos">
                    <h2>Educational Videos</h2>
                    <div class="chat-input" style="margin-bottom: 20px;">
                        <input type="text" id="videoSearch" placeholder="Search for videos...">
                        <button class="btn" onclick="searchVideos()">Search</button>
                        <button class="btn btn-secondary" onclick="searchVideosAuto()">Auto-Search from Document</button>
                    </div>
                    <div id="videosContent" class="videos-container" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentFile = null;
        let quizData = null;
        let quizAnswers = {};
        let testData = null;
        let testAnswers = {};

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
                
                this.classList.add('active');
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
            });
        });

        // File upload
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        async function handleFileUpload(file) {
            const formData = new FormData();
            formData.append('file', file);

            const fileInfo = document.getElementById('fileInfo');
            fileInfo.innerHTML = '<div class="loading"><div class="spinner"></div><p>Uploading and processing...</p></div>';
            fileInfo.style.display = 'block';

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    fileInfo.innerHTML = `
                        <div class="file-info">
                            <h3>‚úÖ File Uploaded Successfully</h3>
                            <p><strong>Filename:</strong> ${data.filename}</p>
                            <p><strong>Content Length:</strong> ${data.content_length.toLocaleString()} characters</p>
                        </div>
                    `;
                    currentFile = data.filename;
                } else {
                    fileInfo.innerHTML = `<div class="file-info" style="background: #ffebee; border-color: #f44336;">‚ùå Error: ${data.error}</div>`;
                }
            } catch (error) {
                fileInfo.innerHTML = `<div class="file-info" style="background: #ffebee; border-color: #f44336;">‚ùå Upload failed: ${error.message}</div>`;
            }
        }

        async function generateSummary() {
            if (!currentFile) {
                alert('Please upload a file first!');
                return;
            }

            const summaryContent = document.getElementById('summaryContent');
            summaryContent.innerHTML = '<div class="loading"><div class="spinner"></div><p>Generating summary...</p></div>';
            summaryContent.style.display = 'block';

            try {
                const response = await fetch('/summarize', { method: 'POST' });
                const data = await response.json();

                if (data.summary) {
                    summaryContent.innerHTML = `<div style="white-space: pre-wrap;">${data.summary}</div>`;
                } else {
                    summaryContent.innerHTML = `<p style="color: red;">Error: ${data.error}</p>`;
                }
            } catch (error) {
                summaryContent.innerHTML = `<p style="color: red;">Failed to generate summary: ${error.message}</p>`;
            }
        }

        async function generateQuiz() {
            if (!currentFile) {
                alert('Please upload a file first!');
                return;
            }

            const quizContent = document.getElementById('quizContent');
            const numQuestions = document.getElementById('numQuestions').value;
            const difficulty = document.getElementById('difficulty').value;

            quizContent.innerHTML = '<div class="loading"><div class="spinner"></div><p>Generating quiz...</p></div>';
            quizContent.style.display = 'block';
            quizAnswers = {};

            try {
                const response = await fetch('/generate-quiz', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ num_questions: parseInt(numQuestions), difficulty })
                });

                const data = await response.json();

                if (data.questions) {
                    quizData = data;
                    displayQuiz(data.questions);
                } else {
                    quizContent.innerHTML = `<p style="color: red;">Error: ${data.error}</p>`;
                }
            } catch (error) {
                quizContent.innerHTML = `<p style="color: red;">Failed to generate quiz: ${error.message}</p>`;
            }
        }

        function displayQuiz(questions) {
            let html = '';
            questions.forEach((q, idx) => {
                html += `
                    <div class="question-card">
                        <h3>Question ${idx + 1}</h3>
                        <p style="font-size: 1.1rem; margin: 15px 0;">${q.question}</p>
                        ${q.options.map((opt, optIdx) => `
                            <div class="option" onclick="selectAnswer(${idx}, ${optIdx})">
                                ${String.fromCharCode(65 + optIdx)}. ${opt}
                            </div>
                        `).join('')}
                        <div id="explanation-${idx}" style="display: none; margin-top: 15px; padding: 15px; background: #e8f5e9; border-radius: 8px;">
                            <strong>Explanation:</strong> ${q.explanation}
                        </div>
                    </div>
                `;
            });

            html += '<button class="btn" onclick="submitQuiz()">Submit Quiz</button>';
            document.getElementById('quizContent').innerHTML = html;
        }

        function selectAnswer(questionIdx, optionIdx) {
            quizAnswers[questionIdx] = optionIdx;
            
            const questionCard = document.querySelectorAll('.question-card')[questionIdx];
            questionCard.querySelectorAll('.option').forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIdx) {
                    opt.classList.add('selected');
                }
            });
        }

        function submitQuiz() {
            let correct = 0;
            quizData.questions.forEach((q, idx) => {
                const questionCard = document.querySelectorAll('.question-card')[idx];
                const options = questionCard.querySelectorAll('.option');
                
                options.forEach((opt, optIdx) => {
                    opt.onclick = null;
                    if (optIdx === q.correct_answer) {
                        opt.classList.add('correct');
                    } else if (optIdx === quizAnswers[idx]) {
                        opt.classList.add('incorrect');
                    }
                });

                if (quizAnswers[idx] === q.correct_answer) {
                    correct++;
                }

                document.getElementById(`explanation-${idx}`).style.display = 'block';
            });

            const percentage = Math.round((correct / quizData.questions.length) * 100);
            const scoreCard = `
                <div class="score-card">
                    <h2>${percentage}%</h2>
                    <p>You scored ${correct} out of ${quizData.questions.length}</p>
                </div>
            `;

            document.getElementById('quizContent').insertAdjacentHTML('afterbegin', scoreCard);
        }

        async function generateMockTest() {
            if (!currentFile) {
                alert('Please upload a file first!');
                return;
            }

            const testContent = document.getElementById('testContent');
            testContent.innerHTML = '<div class="loading"><div class="spinner"></div><p>Generating mock test...</p></div>';
            testContent.style.display = 'block';

            try {
                const response = await fetch('/generate-mock-test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });

                const data = await response.json();

                if (data.test_name) {
                    testData = data;
                    displayMockTest(data);
                } else {
                    testContent.innerHTML = `<p style="color: red;">Error: ${data.error}</p>`;
                }
            } catch (error) {
                testContent.innerHTML = `<p style="color: red;">Failed to generate mock test: ${error.message}</p>`;
            }
        }

        function displayMockTest(data) {
            let html = `
                <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h2>${data.test_name}</h2>
                    <p><strong>Duration:</strong> ${data.duration_minutes} minutes</p>
                </div>
            `;

            let questionCounter = 0;
            data.sections.forEach((section, sectionIdx) => {
                html += `<h3>${section.section_name}</h3>`;
                
                section.questions.forEach((q, qIdx) => {
                    questionCounter++;
                    html += `<div class="question-card">`;
                    html += `<h4>Question ${questionCounter} (${q.points} points)</h4>`;
                    html += `<p style="margin: 15px 0;">${q.question}</p>`;

                    if (q.type === 'mcq') {
                        q.options.forEach((opt, optIdx) => {
                            html += `<div class="option" onclick="selectTestAnswer(${sectionIdx}, ${qIdx}, ${optIdx})">
                                ${String.fromCharCode(65 + optIdx)}. ${opt}
                            </div>`;
                        });
                    } else if (q.type === 'true_false') {
                        html += `
                            <div class="option" onclick="selectTestAnswer(${sectionIdx}, ${qIdx}, true)">True</div>
                            <div class="option" onclick="selectTestAnswer(${sectionIdx}, ${qIdx}, false)">False</div>
                        `;
                    } else if (q.type === 'short_answer') {
                        html += `<textarea id="answer-${sectionIdx}-${qIdx}" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin-top: 10px;" rows="4" placeholder="Type your answer here..."></textarea>`;
                    }

                    html += `<div id="test-explanation-${sectionIdx}-${qIdx}" style="display: none; margin-top: 15px; padding: 15px; background: #e8f5e9; border-radius: 8px;"></div>`;
                    html += `</div>`;
                });
            });

            html += '<button class="btn" onclick="submitMockTest()">Submit Test</button>';
            document.getElementById('testContent').innerHTML = html;
        }

        function selectTestAnswer(sectionIdx, questionIdx, answer) {
            if (!testAnswers[sectionIdx]) {
                testAnswers[sectionIdx] = {};
            }
            testAnswers[sectionIdx][questionIdx] = answer;

            const question = testData.sections[sectionIdx].questions[questionIdx];
            if (question.type === 'mcq' || question.type === 'true_false') {
                const questionCard = document.querySelectorAll('.question-card')[getGlobalQuestionIndex(sectionIdx, questionIdx)];
                questionCard.querySelectorAll('.option').forEach((opt, idx) => {
                    opt.classList.remove('selected');
                });
                
                if (question.type === 'mcq') {
                    questionCard.querySelectorAll('.option')[answer].classList.add('selected');
                } else {
                    questionCard.querySelectorAll('.option')[answer ? 0 : 1].classList.add('selected');
                }
            }
        }

        function getGlobalQuestionIndex(sectionIdx, questionIdx) {
            let counter = 0;
            for (let i = 0; i < sectionIdx; i++) {
                counter += testData.sections[i].questions.length;
            }
            return counter + questionIdx;
        }

        function submitMockTest() {
            let totalPoints = 0;
            let earnedPoints = 0;

            testData.sections.forEach((section, sectionIdx) => {
                section.questions.forEach((q, qIdx) => {
                    totalPoints += q.points;
                    const userAnswer = testAnswers[sectionIdx]?.[qIdx];
                    let isCorrect = false;

                    if (q.type === 'mcq') {
                        isCorrect = userAnswer === q.correct_answer;
                    } else if (q.type === 'true_false') {
                        isCorrect = userAnswer === q.correct_answer;
                    } else if (q.type === 'short_answer') {
                        const textAnswer = document.getElementById(`answer-${sectionIdx}-${qIdx}`).value;
                        // For short answer, we'll give partial credit if answered
                        isCorrect = textAnswer.trim().length > 10;
                    }

                    if (isCorrect) {
                        earnedPoints += q.points;
                    }

                    // Show explanation
                    const explanationDiv = document.getElementById(`test-explanation-${sectionIdx}-${qIdx}`);
                    if (q.explanation) {
                        explanationDiv.innerHTML = `<strong>${isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect'}</strong><br>${q.explanation}`;
                    } else if (q.sample_answer) {
                        explanationDiv.innerHTML = `<strong>Sample Answer:</strong><br>${q.sample_answer}`;
                    }
                    explanationDiv.style.display = 'block';
                });
            });

            const percentage = Math.round((earnedPoints / totalPoints) * 100);
            const scoreCard = `
                <div class="score-card">
                    <h2>${percentage}%</h2>
                    <p>You scored ${earnedPoints} out of ${totalPoints} points</p>
                </div>
            `;

            document.getElementById('testContent').insertAdjacentHTML('afterbegin', scoreCard);
        }

        async function generateMindMap() {
            if (!currentFile) {
                alert('Please upload a file first!');
                return;
            }

            const mindmapContent = document.getElementById('mindmapContent');
            mindmapContent.innerHTML = '<div class="loading"><div class="spinner"></div><p>Generating mind map...</p></div>';
            mindmapContent.style.display = 'block';

            try {
                const response = await fetch('/generate-mindmap', { method: 'POST' });
                const data = await response.json();

                if (data.central_topic) {
                    displayMindMap(data);
                } else {
                    mindmapContent.innerHTML = `<p style="color: red;">Error: ${data.error}</p>`;
                }
            } catch (error) {
                mindmapContent.innerHTML = `<p style="color: red;">Failed to generate mind map: ${error.message}</p>`;
            }
        }

        function displayMindMap(data) {
            let html = `
                <div style="text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px;">
                    <h2 style="color: white; font-size: 2rem;">${data.central_topic}</h2>
                </div>
            `;

            data.branches.forEach(branch => {
                html += `
                    <div class="mindmap-node">
                        <h3 style="color: #667eea; font-size: 1.5rem;">${branch.title}</h3>
                        <div class="mindmap-branch">
                `;

                branch.subtopics.forEach(subtopic => {
                    html += `
                        <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 3px solid #764ba2;">
                            <h4 style="color: #333; margin-bottom: 10px;">${subtopic.title}</h4>
                            <ul style="margin-left: 20px;">
                                ${subtopic.points.map(point => `<li style="margin: 5px 0;">${point}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            });

            document.getElementById('mindmapContent').innerHTML = html;
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            const messagesDiv = document.getElementById('chatMessages');
            messagesDiv.innerHTML += `<div class="message user">${message}</div>`;
            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            messagesDiv.innerHTML += `<div class="message assistant">Thinking...</div>`;

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });

                const data = await response.json();

                // Remove "Thinking..." message
                messagesDiv.removeChild(messagesDiv.lastChild);

                if (data.response) {
                    messagesDiv.innerHTML += `<div class="message assistant">${data.response}</div>`;
                } else {
                    messagesDiv.innerHTML += `<div class="message assistant" style="background: #ffebee;">Error: ${data.error}</div>`;
                }

                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            } catch (error) {
                messagesDiv.innerHTML += `<div class="message assistant" style="background: #ffebee;">Error: ${error.message}</div>`;
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }
        }

        function handleChatKeypress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function searchVideos() {
            const query = document.getElementById('videoSearch').value.trim();
            if (!query) {
                alert('Please enter a search query!');
                return;
            }

            await performVideoSearch(query);
        }

        async function searchVideosAuto() {
            if (!currentFile) {
                alert('Please upload a file first!');
                return;
            }

            await performVideoSearch('');
        }

        async function performVideoSearch(query) {
            const videosContent = document.getElementById('videosContent');
            videosContent.innerHTML = '<div class="loading"><div class="spinner"></div><p>Searching for videos...</p></div>';
            videosContent.style.display = 'block';

            try {
                const response = await fetch('/search-videos', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });

                const data = await response.json();

                if (data.videos && data.videos.length > 0) {
                    let html = `<h3>Search Results for: "${data.query}"</h3><div class="video-grid">`;
                    
                    data.videos.forEach(video => {
                        html += `
                            <div class="video-card">
                                <a href="https://www.youtube.com/watch?v=${video.videoId}" target="_blank">
                                    <img src="${video.thumbnail}" alt="${video.title}">
                                </a>
                                <div class="video-info">
                                    <div class="video-title">${video.title}</div>
                                    <div class="video-channel">${video.channelTitle}</div>
                                </div>
                            </div>
                        `;
                    });

                    html += '</div>';
                    videosContent.innerHTML = html;
                } else {
                    videosContent.innerHTML = '<p>No videos found. Please try a different search query or check your YouTube API configuration.</p>';
                }
            } catch (error) {
                videosContent.innerHTML = `<p style="color: red;">Failed to search videos: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
